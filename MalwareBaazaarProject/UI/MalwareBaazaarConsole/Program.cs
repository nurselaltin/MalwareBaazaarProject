using Business.Concrete;
using DataAccess.Abstract;
using DataAccess.Concrete.EntityFramework;
using Entities.Concrete;
using MalwareBaazaarConsole.Services;
using System;

namespace MalwareBaazaarConsole
{
    class Program
    {
        static void Main(string[] args)
        {
            


            string api_key = "d6e8e9ae619819a83a2c638c3b2e9592";
            string recentHashUrl = "https://bazaar.abuse.ch/export/txt/md5/recent/";
            string hashInfoUrl = "https://mb-api.abuse.ch/api/v1/";

            IHashDal hahsDal = new EfHashDal();
            HashManager hashManager = new HashManager(hahsDal); 


            MalwareBaazaarService request = new MalwareBaazaarService(api_key);


            var hashes = request.GetHashes(recentHashUrl);

            foreach (var item in hashes)
            {

                Hash hash =  request.GetHashData(item, hashInfoUrl);
                hashManager.Add(hash);
                Console.WriteLine("  #####   HASH   #####");
                Console.WriteLine("-------------------------------------------");
                Console.WriteLine(hash.first_seen);
                Console.WriteLine(hash.md5_hash);
                Console.WriteLine(hash.sha1_hash);
                Console.WriteLine(hash.sha256_hash);
                Console.WriteLine(hash.signature);
                Console.WriteLine(hash.tags);
                Console.WriteLine("--------------------------------------------------");
                Console.WriteLine();


            }
        }
    }
}
